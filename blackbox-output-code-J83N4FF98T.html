<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Canciones con IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Generador de Canciones con IA</h1>
        <p class="text-center">Escribe tu texto, elige un género y un artista. La IA transformará el texto en una canción con tonos y voz imitando al artista.</p>
        
        <form id="songForm">
            <div class="mb-3">
                <label for="textInput" class="form-label">Texto a transformar en canción:</label>
                <textarea class="form-control" id="textInput" rows="4" placeholder="Escribe aquí tu historia, poema o idea..."></textarea>
            </div>
            
            <div class="mb-3">
                <label for="genreSelect" class="form-label">Género musical:</label>
                <select class="form-select" id="genreSelect">
                    <option value="pop">Pop</option>
                    <option value="rock">Rock</option>
                    <option value="hiphop">Hip-Hop</option>
                    <option value="jazz">Jazz</option>
                    <option value="reggaeton">Reggaeton</option>
                    <option value="clasica">Clásica</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="artistInput" class="form-label">Artista para imitar la voz (ej: Michael Jackson, Adele):</label>
                <input type="text" class="form-control" id="artistInput" placeholder="Ingresa el nombre del artista">
            </div>
            
            <button type="submit" class="btn btn-primary">Generar Canción</button>
        </form>
        
        <div id="result" class="mt-4" style="display: none;">
            <h3>Canción Generada:</h3>
            <p id="lyrics"></p>
            <p><strong>Género:</strong> <span id="selectedGenre"></span></p>
            <p><strong>Artista Imitado:</strong> <span id="selectedArtist"></span></p>
            <audio id="audioPlayer" controls style="display: none;">
                <source src="" type="audio/mpeg">
                Tu navegador no soporta audio.
            </audio>
            <p id="audioNote" class="text-muted">Nota: Audio generado con IA. Puede tardar unos segundos.</p>
        </div>
    </div>

    <script>
        document.getElementById('songForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const text = document.getElementById('textInput').value;
            const genre = document.getElementById('genreSelect').value;
            const artist = document.getElementById('artistInput').value;
            
            if (!text || !artist) {
                alert('Por favor, ingresa texto y un artista.');
                return;
            }
            
            // Mostrar loading
            document.getElementById('result').style.display = 'block';
            document.getElementById('lyrics').textContent = 'Generando letras...';
            document.getElementById('audioPlayer').style.display = 'none';
            
            try {
                // Paso 1: Generar letras con OpenAI
                const lyrics = await generateLyrics(text, genre, artist);
                document.getElementById('lyrics').textContent = lyrics;
                document.getElementById('selectedGenre').textContent = genre;
                document.getElementById('selectedArtist').textContent = artist;
                
                // Paso 2: Generar audio con ElevenLabs (usando una muestra de voz ficticia; en realidad, busca una URL)
                const voiceSampleUrl = 'https://example.com/sample-voice.mp3'; // Reemplaza con una URL real de muestra de voz del artista (busca en APIs como YouTube o Google)
                const audioUrl = await generateAudio(lyrics, voiceSampleUrl);
                document.getElementById('audioPlayer').src = audioUrl;
                document.getElementById('audioPlayer').style.display = 'block';
                
            } catch (error) {
                alert('Error al generar la canción: ' + error.message);
            }
        });
        
        // Función para generar letras con OpenAI
        async function generateLyrics(text, genre, artist) {
            const apiKey = 'TU_CLAVE_API_OPENAI_AQUI'; // Reemplaza con tu clave real
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{
                        role: 'user',
                        content: `Transforma este texto en letras de una canción en género ${genre}, imitando el estilo de ${artist}: "${text}". Hazlo poético y rítmico.`
                    }],
                    max_tokens: 500
                })
            });
            const data = await response.json();
            if (!response.ok) throw new Error(data.error.message);
            return data.choices[0].message.content;
        }
        
        // Función para generar audio con ElevenLabs
        async function generateAudio(lyrics, voiceSampleUrl) {
            const apiKey = 'TU_CLAVE_API_ELEVENLABS_AQUI'; // Reemplaza con tu clave real
            // Primero, clona la voz usando la muestra (esto es simplificado; ElevenLabs requiere subir una muestra)
            const voiceId = await cloneVoice(voiceSampleUrl); // Función auxiliar para clonar voz
            
            // Genera audio con la voz clonada
            const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'Content-Type': 'application/json',
                    'xi-api-key': apiKey
                },
                body: JSON.stringify({
                    text: lyrics,
                    model_id: 'eleven_monolingual_v1',
                    voice_settings: { stability: 0.5, similarity_boost: 0.5 }
                })
            });
            if (!response.ok) throw new Error('Error en generación de audio');
            const blob = await response.blob();
            return URL.createObjectURL(blob); // Devuelve una URL temporal para el audio
        }
        
        // Función auxiliar para clonar voz (simplificada; ElevenLabs tiene endpoints para esto)
        async function cloneVoice(sampleUrl) {
            // En la práctica, sube la muestra a ElevenLabs y obtén un voice_id
            // Aquí simulo un ID ficticio; integra fetch para subir archivo
            return 'voice_id_ficticio'; // Reemplaza con lógica real para obtener voice_id
        }
    </script>
</body>
</html>